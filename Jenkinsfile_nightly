#!groovy

properties([
        pipelineTriggers([cron('10 21 * * *')]),

      parameters([

        string(name: 'URL_TO_TEST', defaultValue: 'https://idam-web-admin-idam-aat.service.core-compute-idam-aat.internal', description: 'The URL you want to run these tests against'),
    ])
])

@Library("Infrastructure")

def type = "java"

def product = "idam"

def component = "web-public"

withNightlyPipeline(type, product, component) {
 
   after('DependencyCheckNightly') {
        env.TEST_URL = params.URL_TO_TEST
        enableSecurityScan()

        sh "./gradlew --no-daemon --init-script init.gradle pitest"

        archiveArtifacts '**/build/reports/pitest/**/*'

        withSonarQubeEnv("SonarQube") {
            sh "./gradlew --info sonarqube"
        }
    }

  
}

